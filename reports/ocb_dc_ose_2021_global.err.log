Traceback (most recent call last):
  File "/raid/localscratch/qfebvre/ocb/ocb-docs/lib/python3.11/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/raid/localscratch/qfebvre/ocb/ocb-docs/lib/python3.11/site-packages/nbclient/client.py", line 1314, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/raid/localscratch/qfebvre/ocb/ocb-docs/lib/python3.11/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/raid/localscratch/qfebvre/ocb/ocb-docs/lib/python3.11/asyncio/base_events.py", line 650, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/raid/localscratch/qfebvre/ocb/ocb-docs/lib/python3.11/contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "/raid/localscratch/qfebvre/ocb/ocb-docs/lib/python3.11/site-packages/nbclient/client.py", line 654, in async_setup_kernel
    yield
  File "/raid/localscratch/qfebvre/ocb/ocb-docs/lib/python3.11/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/raid/localscratch/qfebvre/ocb/ocb-docs/lib/python3.11/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/raid/localscratch/qfebvre/ocb/ocb-docs/lib/python3.11/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
import numpy as np
import xarray as xr
import pandas as pd
from functools import partial
from xrpatcher import XRDAPatcher
from patcher_oi_torch import oi


outgrid = oi(
    outgrid_da=xr.DataArray(
        dims=('time', 'lat', 'lon'),
        coords=dict(
            time=pd.date_range('2019-05-15', '2019-05-15'),
            lat=np.arange(-90, 90, .25),
            lon=np.arange(-180, 180, .25),
        ),
    ),
    patcher_cls=partial(XRDAPatcher,
        patches=dict(time=1, lat=40, lon=80),
        strides=dict(time=1, lat=40, lon=80)
    ),
    obs=obs.load(),
    lt=pd.to_timedelta('7D'), lx=1., ly=1.,
    noise=0.05,
    obs_dt=pd.to_timedelta('2D'), obs_dx=.5, obs_dy=.5,
    device='cuda'
)
------------------

----- stderr -----
  0%|                                                                                                                          | 0/324 [00:00<?, ?it/s]
----- stderr -----
  0%|▎                                                                                                                 | 1/324 [00:04<23:56,  4.45s/it]
----- stderr -----
  1%|▋                                                                                                                 | 2/324 [00:09<24:48,  4.62s/it]
----- stderr -----
  1%|█                                                                                                                 | 3/324 [00:14<26:30,  4.96s/it]
----- stderr -----
  1%|█▍                                                                                                                | 4/324 [00:19<26:22,  4.95s/it]
----- stderr -----
  2%|█▊                                                                                                                | 5/324 [00:24<27:01,  5.08s/it]
----- stderr -----
  2%|██                                                                                                                | 6/324 [00:30<28:06,  5.30s/it]
----- stderr -----
  2%|██▍                                                                                                               | 7/324 [00:36<29:15,  5.54s/it]
----- stderr -----
  2%|██▊                                                                                                               | 8/324 [00:44<32:52,  6.24s/it]
----- stderr -----
  3%|███▏                                                                                                              | 9/324 [00:53<37:54,  7.22s/it]
----- stderr -----
  3%|███▍                                                                                                             | 10/324 [01:01<39:12,  7.49s/it]
----- stderr -----
  3%|███▊                                                                                                             | 11/324 [01:07<35:34,  6.82s/it]
----- stderr -----
  4%|████▏                                                                                                            | 12/324 [01:13<34:25,  6.62s/it]
----- stderr -----
  4%|████▌                                                                                                            | 13/324 [01:18<32:10,  6.21s/it]
----- stderr -----
  4%|████▉                                                                                                            | 14/324 [01:23<30:30,  5.91s/it]
----- stderr -----
  5%|█████▏                                                                                                           | 15/324 [01:24<22:17,  4.33s/it]
----- stderr -----
  5%|█████▌                                                                                                           | 16/324 [01:24<15:55,  3.10s/it]
----- stderr -----
  5%|█████▉                                                                                                           | 17/324 [01:24<11:26,  2.24s/it]
----- stderr -----
  6%|██████▎                                                                                                          | 18/324 [01:25<08:22,  1.64s/it]
----- stderr -----
  6%|██████▎                                                                                                          | 18/324 [01:28<25:03,  4.91s/it]
----- stderr -----

------------------

[0;31m---------------------------------------------------------------------------[0m
[0;31mOutOfMemoryError[0m                          Traceback (most recent call last)
Cell [0;32mIn[9], line 9[0m
[1;32m      5[0m [38;5;28;01mfrom[39;00m [38;5;21;01mxrpatcher[39;00m [38;5;28;01mimport[39;00m XRDAPatcher
[1;32m      6[0m [38;5;28;01mfrom[39;00m [38;5;21;01mpatcher_oi_torch[39;00m [38;5;28;01mimport[39;00m oi
[0;32m----> 9[0m outgrid [38;5;241m=[39m [43moi[49m[43m([49m
[1;32m     10[0m [43m    [49m[43moutgrid_da[49m[38;5;241;43m=[39;49m[43mxr[49m[38;5;241;43m.[39;49m[43mDataArray[49m[43m([49m
[1;32m     11[0m [43m        [49m[43mdims[49m[38;5;241;43m=[39;49m[43m([49m[38;5;124;43m'[39;49m[38;5;124;43mtime[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[38;5;124;43m'[39;49m[38;5;124;43mlat[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[38;5;124;43m'[39;49m[38;5;124;43mlon[39;49m[38;5;124;43m'[39;49m[43m)[49m[43m,[49m
[1;32m     12[0m [43m        [49m[43mcoords[49m[38;5;241;43m=[39;49m[38;5;28;43mdict[39;49m[43m([49m
[1;32m     13[0m [43m            [49m[43mtime[49m[38;5;241;43m=[39;49m[43mpd[49m[38;5;241;43m.[39;49m[43mdate_range[49m[43m([49m[38;5;124;43m'[39;49m[38;5;124;43m2019-05-15[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[38;5;124;43m'[39;49m[38;5;124;43m2019-05-15[39;49m[38;5;124;43m'[39;49m[43m)[49m[43m,[49m
[1;32m     14[0m [43m            [49m[43mlat[49m[38;5;241;43m=[39;49m[43mnp[49m[38;5;241;43m.[39;49m[43marange[49m[43m([49m[38;5;241;43m-[39;49m[38;5;241;43m90[39;49m[43m,[49m[43m [49m[38;5;241;43m90[39;49m[43m,[49m[43m [49m[38;5;241;43m.25[39;49m[43m)[49m[43m,[49m
[1;32m     15[0m [43m            [49m[43mlon[49m[38;5;241;43m=[39;49m[43mnp[49m[38;5;241;43m.[39;49m[43marange[49m[43m([49m[38;5;241;43m-[39;49m[38;5;241;43m180[39;49m[43m,[49m[43m [49m[38;5;241;43m180[39;49m[43m,[49m[43m [49m[38;5;241;43m.25[39;49m[43m)[49m[43m,[49m
[1;32m     16[0m [43m        [49m[43m)[49m[43m,[49m
[1;32m     17[0m [43m    [49m[43m)[49m[43m,[49m
[1;32m     18[0m [43m    [49m[43mpatcher_cls[49m[38;5;241;43m=[39;49m[43mpartial[49m[43m([49m[43mXRDAPatcher[49m[43m,[49m
[1;32m     19[0m [43m        [49m[43mpatches[49m[38;5;241;43m=[39;49m[38;5;28;43mdict[39;49m[43m([49m[43mtime[49m[38;5;241;43m=[39;49m[38;5;241;43m1[39;49m[43m,[49m[43m [49m[43mlat[49m[38;5;241;43m=[39;49m[38;5;241;43m40[39;49m[43m,[49m[43m [49m[43mlon[49m[38;5;241;43m=[39;49m[38;5;241;43m80[39;49m[43m)[49m[43m,[49m
[1;32m     20[0m [43m        [49m[43mstrides[49m[38;5;241;43m=[39;49m[38;5;28;43mdict[39;49m[43m([49m[43mtime[49m[38;5;241;43m=[39;49m[38;5;241;43m1[39;49m[43m,[49m[43m [49m[43mlat[49m[38;5;241;43m=[39;49m[38;5;241;43m40[39;49m[43m,[49m[43m [49m[43mlon[49m[38;5;241;43m=[39;49m[38;5;241;43m80[39;49m[43m)[49m
[1;32m     21[0m [43m    [49m[43m)[49m[43m,[49m
[1;32m     22[0m [43m    [49m[43mobs[49m[38;5;241;43m=[39;49m[43mobs[49m[38;5;241;43m.[39;49m[43mload[49m[43m([49m[43m)[49m[43m,[49m
[1;32m     23[0m [43m    [49m[43mlt[49m[38;5;241;43m=[39;49m[43mpd[49m[38;5;241;43m.[39;49m[43mto_timedelta[49m[43m([49m[38;5;124;43m'[39;49m[38;5;124;43m7D[39;49m[38;5;124;43m'[39;49m[43m)[49m[43m,[49m[43m [49m[43mlx[49m[38;5;241;43m=[39;49m[38;5;241;43m1.[39;49m[43m,[49m[43m [49m[43mly[49m[38;5;241;43m=[39;49m[38;5;241;43m1.[39;49m[43m,[49m
[1;32m     24[0m [43m    [49m[43mnoise[49m[38;5;241;43m=[39;49m[38;5;241;43m0.05[39;49m[43m,[49m
[1;32m     25[0m [43m    [49m[43mobs_dt[49m[38;5;241;43m=[39;49m[43mpd[49m[38;5;241;43m.[39;49m[43mto_timedelta[49m[43m([49m[38;5;124;43m'[39;49m[38;5;124;43m2D[39;49m[38;5;124;43m'[39;49m[43m)[49m[43m,[49m[43m [49m[43mobs_dx[49m[38;5;241;43m=[39;49m[38;5;241;43m.5[39;49m[43m,[49m[43m [49m[43mobs_dy[49m[38;5;241;43m=[39;49m[38;5;241;43m.5[39;49m[43m,[49m
[1;32m     26[0m [43m    [49m[43mdevice[49m[38;5;241;43m=[39;49m[38;5;124;43m'[39;49m[38;5;124;43mcuda[39;49m[38;5;124;43m'[39;49m
[1;32m     27[0m [43m)[49m

File [0;32m/tmp/tmpsv4gc06w/patcher_oi_torch.py:101[0m, in [0;36moi[0;34m(outgrid_da, patcher_cls, obs, obs_var, lt, lx, ly, noise, obs_dt, obs_dx, obs_dy, device)[0m
[1;32m     97[0m R [38;5;241m=[39m torch[38;5;241m.[39mdiag(torch[38;5;241m.[39mfull((nobs,), noise[38;5;241m*[39m[38;5;241m*[39m[38;5;241m2[39m, device[38;5;241m=[39mtobs_time[38;5;241m.[39mdevice))
[1;32m    100[0m Coo [38;5;241m=[39m HBHt [38;5;241m+[39m R
[0;32m--> 101[0m Mi [38;5;241m=[39m [43mtorch[49m[38;5;241;43m.[39;49m[43mlinalg[49m[38;5;241;43m.[39;49m[43minv[49m[43m([49m[43mCoo[49m[43m)[49m
[1;32m    102[0m Iw [38;5;241m=[39m torch[38;5;241m.[39mmm(BHt, Mi)
[1;32m    103[0m sol[38;5;241m=[39mtorch[38;5;241m.[39mmv(Iw, tobs_values)

[0;31mOutOfMemoryError[0m: CUDA out of memory. Tried to allocate 20.00 MiB. GPU 0 has a total capacity of 79.35 GiB of which 23.12 MiB is free. Process 929859 has 27.12 GiB memory in use. Process 3305133 has 17.68 GiB memory in use. Process 344815 has 33.05 GiB memory in use. Including non-PyTorch memory, this process has 1.47 GiB memory in use. Of the allocated memory 69.00 KiB is allocated by PyTorch, and 1.93 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)

